<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Power Spectral Density Analysis: Spectral Decoupling &#8212; research-projects  documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/bootstrap-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-binder.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-dataframe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-rendered-html.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="../_static/js/jquery-1.12.4.min.js"></script>
<script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
<script type="text/javascript" src="../_static/bootstrap-3.4.1/js/bootstrap.min.js"></script>
<script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>

  </head><body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../index.html">
          research-projects</a>
        <span class="navbar-text navbar-version pull-left"><b></b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="index.html">Examples</a></li>
                <li><a href="https://github.com/alexrockhill/research-projects">GitHub</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"></ul>
</li>
              
            
            
            
            
            
              <li class="hidden-sm">
<div id="sourcelink">
  <a href="../_sources/auto_examples/plot_power_spectral_density.rst.txt"
     rel="nofollow">Source</a>
</div></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference internal" href="#sphx-glr-download-auto-examples-plot-power-spectral-density-py"><span class="std std-ref">Go to the end</span></a>
to download the full example code</p>
</div>
<section class="sphx-glr-example-title" id="power-spectral-density-analysis-spectral-decoupling">
<span id="tut-sensors-psd"></span><span id="sphx-glr-auto-examples-plot-power-spectral-density-py"></span><h1>Power Spectral Density Analysis: Spectral Decoupling<a class="headerlink" href="#power-spectral-density-analysis-spectral-decoupling" title="Permalink to this heading">¶</a></h1>
<p>The objective of this tutorial is to describe the basics of power spectral
density and what it can tell us about underlying brain activity. Power spectral
density represents time-series data as the magnitude of sine and cosine
coefficients of the Fourtier Transform; how much of each different
frequency of sinusoidal wave best represents your time-series data. While,
understandably, this method is great at detecting oscillatory neural activity
(activity that waxes and wanes periodically at a particular frequency
or rhythm), interestingly, it also yields important information about
aperiodic neural activity through the background or broadband changes in power.
Brain activity is consistently observed to have exponentially decreasing
background power, like pink noise, with oscillatory peaks superimposed,
like the peaks in a nuclear magnetic resonance (NMR) spectroscopy scan. The
peaks can tell us about oscillatory (periodic), synchronous brain activity
and the background power can tell us about non-oscillatory (aperiodic),
asynchronous brain activity. (For contrast, an event-related potential,
the deflection in an electrophysiology recording after an event is shown,
is aperiodic because it doesn’t repeat but synchronous because it is
synchronized by the event). This tutorial will demonstrate how this
interpretation of power spectral density can be used to study a movement
task. Unfortunately, since this method was demonstrated on
electrocortigraphy (ECoG) which can discriminate the location of brain
activity at much better resolution than scalp electroencephalography (EEG),
we won’t be able to show that, during movement, the broadband changes
in power are confined to a more specific brain area (the brain area
that controls that particular movement) whereas the oscillation is
spread across a large portion of primary motor cortex (the gyrus that,
when stimulated, causes movement of different body parts depending
on the location of stimulation) but please read <a class="footnote-reference brackets" href="#footcite-milleretal2009a" id="id1" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a>
for more details.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Authors: Alex Rockhill &lt;aprockhill@mailbox.org&gt;</span>
<span class="c1">#</span>
<span class="c1"># License: BSD-3-Clause</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">sklearn.decomposition</span> <span class="kn">import</span> <span class="n">PCA</span><span class="p">,</span> <span class="n">FactorAnalysis</span>
<span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">minimize</span>
<span class="kn">from</span> <span class="nn">scipy.signal</span> <span class="kn">import</span> <span class="n">find_peaks</span>

<span class="kn">import</span> <span class="nn">mne</span>
<span class="kn">from</span> <span class="nn">mne.datasets</span> <span class="kn">import</span> <span class="n">eegbci</span>
</pre></div>
</div>
<p>Load the data: from <a class="reference external" href="https://mne.tools/stable/auto_examples/preprocessing/eeg_bridging.html#ex-eeg-bridging" title="(in MNE v1.6)"><span>Identify EEG Electrodes Bridged by too much Gel</span></a> we can see that subject 5
has no bridging and from the documentation in <a class="reference external" href="https://mne.tools/stable/generated/mne.datasets.eegbci.load_data.html#mne.datasets.eegbci.load_data" title="(in MNE v1.6)"><code class="xref py py-func docutils literal notranslate"><span class="pre">mne.datasets.eegbci.load_data()</span></code></a>
we can pick the runs where the subject was performing a movement task
(3, 5, 7, 9, 11, 13).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">raw_fnames</span> <span class="o">=</span> <a href="https://mne.tools/stable/generated/mne.datasets.eegbci.load_data.html#mne.datasets.eegbci.load_data" title="mne.datasets.eegbci.load_data" class="sphx-glr-backref-module-mne-datasets-eegbci sphx-glr-backref-type-py-function"><span class="n">eegbci</span><span class="o">.</span><span class="n">load_data</span></a><span class="p">(</span><span class="n">subject</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">runs</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">13</span><span class="p">])</span>
<span class="n">raws</span> <span class="o">=</span> <span class="p">[</span><a href="https://mne.tools/stable/generated/mne.io.read_raw.html#mne.io.read_raw" title="mne.io.read_raw" class="sphx-glr-backref-module-mne-io sphx-glr-backref-type-py-function"><span class="n">mne</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read_raw</span></a><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">preload</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">raw_fnames</span><span class="p">]</span>

<span class="c1"># join files and standardize format</span>
<span class="n">raw</span> <span class="o">=</span> <a href="https://mne.tools/stable/generated/mne.concatenate_raws.html#mne.concatenate_raws" title="mne.concatenate_raws" class="sphx-glr-backref-module-mne sphx-glr-backref-type-py-function"><span class="n">mne</span><span class="o">.</span><span class="n">concatenate_raws</span></a><span class="p">(</span><span class="n">raws</span><span class="p">)</span>
<a href="https://mne.tools/stable/generated/mne.datasets.eegbci.standardize.html#mne.datasets.eegbci.standardize" title="mne.datasets.eegbci.standardize" class="sphx-glr-backref-module-mne-datasets-eegbci sphx-glr-backref-type-py-function"><span class="n">eegbci</span><span class="o">.</span><span class="n">standardize</span></a><span class="p">(</span><span class="n">raw</span><span class="p">)</span>  <span class="c1"># set channel names</span>
<span class="n">raw</span><span class="o">.</span><span class="n">set_montage</span><span class="p">(</span><span class="s2">&quot;standard_1005&quot;</span><span class="p">)</span>

<span class="c1"># make epochs</span>
<span class="n">events</span><span class="p">,</span> <span class="n">event_id</span> <span class="o">=</span> <a href="https://mne.tools/stable/generated/mne.events_from_annotations.html#mne.events_from_annotations" title="mne.events_from_annotations" class="sphx-glr-backref-module-mne sphx-glr-backref-type-py-function"><span class="n">mne</span><span class="o">.</span><span class="n">events_from_annotations</span></a><span class="p">(</span><span class="n">raw</span><span class="p">)</span>
<span class="c1"># four seconds of movement/rest; start 1 s after onset and end 1s before</span>
<span class="c1"># offset for just movement/rest</span>
<a href="https://mne.tools/stable/generated/mne.Epochs.html#mne.Epochs" title="mne.Epochs" class="sphx-glr-backref-module-mne sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">epochs</span></a> <span class="o">=</span> <a href="https://mne.tools/stable/generated/mne.Epochs.html#mne.Epochs" title="mne.Epochs" class="sphx-glr-backref-module-mne sphx-glr-backref-type-py-class"><span class="n">mne</span><span class="o">.</span><span class="n">Epochs</span></a><span class="p">(</span>
    <span class="n">raw</span><span class="p">,</span> <span class="n">events</span><span class="p">,</span> <span class="n">tmin</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">tmax</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">reject</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">eeg</span><span class="o">=</span><span class="mf">4e-4</span><span class="p">),</span> <span class="n">baseline</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">preload</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Extracting EDF parameters from /home/alexrockhill/mne_data/MNE-eegbci-data/files/eegmmidb/1.0.0/S005/S005R03.edf...
EDF file detected
Setting channel info structure...
Creating raw.info structure...
Reading 0 ... 19679  =      0.000 ...   122.994 secs...
Extracting EDF parameters from /home/alexrockhill/mne_data/MNE-eegbci-data/files/eegmmidb/1.0.0/S005/S005R05.edf...
EDF file detected
Setting channel info structure...
Creating raw.info structure...
Reading 0 ... 19679  =      0.000 ...   122.994 secs...
Extracting EDF parameters from /home/alexrockhill/mne_data/MNE-eegbci-data/files/eegmmidb/1.0.0/S005/S005R07.edf...
EDF file detected
Setting channel info structure...
Creating raw.info structure...
Reading 0 ... 19679  =      0.000 ...   122.994 secs...
Extracting EDF parameters from /home/alexrockhill/mne_data/MNE-eegbci-data/files/eegmmidb/1.0.0/S005/S005R09.edf...
EDF file detected
Setting channel info structure...
Creating raw.info structure...
Reading 0 ... 19679  =      0.000 ...   122.994 secs...
Extracting EDF parameters from /home/alexrockhill/mne_data/MNE-eegbci-data/files/eegmmidb/1.0.0/S005/S005R11.edf...
EDF file detected
Setting channel info structure...
Creating raw.info structure...
Reading 0 ... 19679  =      0.000 ...   122.994 secs...
Extracting EDF parameters from /home/alexrockhill/mne_data/MNE-eegbci-data/files/eegmmidb/1.0.0/S005/S005R13.edf...
EDF file detected
Setting channel info structure...
Creating raw.info structure...
Reading 0 ... 19679  =      0.000 ...   122.994 secs...
Used Annotations descriptions: [&#39;T0&#39;, &#39;T1&#39;, &#39;T2&#39;]
Not setting metadata
180 matching events found
No baseline correction applied
0 projection items activated
Using data from preloaded Raw for 180 events and 321 original time points ...
    Rejecting  epoch based on EEG : [&#39;AF7&#39;]
    Rejecting  epoch based on EEG : [&#39;Fp1&#39;, &#39;Fpz&#39;, &#39;Fp2&#39;, &#39;AF7&#39;, &#39;AF8&#39;]
    Rejecting  epoch based on EEG : [&#39;Fp1&#39;, &#39;Fpz&#39;, &#39;Fp2&#39;, &#39;AF7&#39;, &#39;AF8&#39;, &#39;F7&#39;]
    Rejecting  epoch based on EEG : [&#39;Fp1&#39;, &#39;Fpz&#39;, &#39;Fp2&#39;, &#39;AF7&#39;, &#39;AF4&#39;, &#39;AF8&#39;]
    Rejecting  epoch based on EEG : [&#39;Fp1&#39;, &#39;Fp2&#39;, &#39;AF7&#39;, &#39;AF8&#39;]
    Rejecting  epoch based on EEG : [&#39;Fp1&#39;, &#39;AF7&#39;, &#39;AF8&#39;]
    Rejecting  epoch based on EEG : [&#39;FC5&#39;, &#39;Fp1&#39;, &#39;Fpz&#39;, &#39;Fp2&#39;, &#39;AF7&#39;, &#39;F7&#39;, &#39;TP7&#39;]
    Rejecting  epoch based on EEG : [&#39;AF7&#39;]
    Rejecting  epoch based on EEG : [&#39;CP1&#39;]
    Rejecting  epoch based on EEG : [&#39;Fp1&#39;]
    Rejecting  epoch based on EEG : [&#39;AF7&#39;, &#39;F7&#39;]
    Rejecting  epoch based on EEG : [&#39;Fp1&#39;, &#39;AF8&#39;]
    Rejecting  epoch based on EEG : [&#39;FC5&#39;, &#39;Fp1&#39;, &#39;Fp2&#39;]
    Rejecting  epoch based on EEG : [&#39;Fp1&#39;, &#39;Fp2&#39;, &#39;AF7&#39;, &#39;AF8&#39;, &#39;F5&#39;]
    Rejecting  epoch based on EEG : [&#39;TP7&#39;]
    Rejecting  epoch based on EEG : [&#39;Fp1&#39;, &#39;Fpz&#39;, &#39;Fp2&#39;, &#39;AF7&#39;, &#39;AF4&#39;, &#39;AF8&#39;, &#39;F7&#39;]
    Rejecting  epoch based on EEG : [&#39;Fp1&#39;]
    Rejecting  epoch based on EEG : [&#39;Fp1&#39;, &#39;Fp2&#39;, &#39;AF7&#39;, &#39;AF8&#39;]
    Rejecting  epoch based on EEG : [&#39;Fp1&#39;, &#39;AF7&#39;, &#39;AF8&#39;]
    Rejecting  epoch based on EEG : [&#39;FC5&#39;, &#39;Fp1&#39;, &#39;AF7&#39;, &#39;F7&#39;, &#39;F5&#39;, &#39;TP7&#39;]
    Rejecting  epoch based on EEG : [&#39;FC5&#39;, &#39;AF7&#39;, &#39;F7&#39;]
    Rejecting  epoch based on EEG : [&#39;AF4&#39;]
    Rejecting  epoch based on EEG : [&#39;AF7&#39;]
    Rejecting  epoch based on EEG : [&#39;Fp1&#39;, &#39;Fpz&#39;, &#39;Fp2&#39;, &#39;AF7&#39;, &#39;AF8&#39;]
    Rejecting  epoch based on EEG : [&#39;AF7&#39;]
    Rejecting  epoch based on EEG : [&#39;FC5&#39;, &#39;FC1&#39;, &#39;Fp1&#39;, &#39;Fpz&#39;, &#39;Fp2&#39;, &#39;AF7&#39;, &#39;AF3&#39;, &#39;AFz&#39;, &#39;AF4&#39;, &#39;AF8&#39;, &#39;F7&#39;, &#39;F5&#39;, &#39;F3&#39;, &#39;F1&#39;, &#39;Fz&#39;, &#39;FT7&#39;]
    Rejecting  epoch based on EEG : [&#39;TP7&#39;]
    Rejecting  epoch based on EEG : [&#39;FC5&#39;]
    Rejecting  epoch based on EEG : [&#39;Fp1&#39;, &#39;Fpz&#39;, &#39;Fp2&#39;, &#39;AF7&#39;, &#39;AF8&#39;]
    Rejecting  epoch based on EEG : [&#39;Fp1&#39;, &#39;Fpz&#39;, &#39;Fp2&#39;, &#39;AF7&#39;, &#39;AF8&#39;]
    Rejecting  epoch based on EEG : [&#39;Fp1&#39;, &#39;AF7&#39;, &#39;AF8&#39;]
    Rejecting  epoch based on EEG : [&#39;Fp1&#39;, &#39;Fpz&#39;, &#39;Fp2&#39;, &#39;AF7&#39;, &#39;AF8&#39;]
    Rejecting  epoch based on EEG : [&#39;FC4&#39;, &#39;FC6&#39;, &#39;Fp1&#39;, &#39;Fpz&#39;, &#39;Fp2&#39;, &#39;AF7&#39;, &#39;AF3&#39;, &#39;AFz&#39;, &#39;AF4&#39;, &#39;AF8&#39;, &#39;F7&#39;, &#39;F5&#39;, &#39;F3&#39;, &#39;F1&#39;, &#39;F4&#39;, &#39;F6&#39;, &#39;F8&#39;, &#39;FT7&#39;, &#39;T7&#39;, &#39;TP7&#39;, &#39;P1&#39;, &#39;P2&#39;, &#39;P4&#39;, &#39;P8&#39;, &#39;Iz&#39;]
    Rejecting  epoch based on EEG : [&#39;FC5&#39;, &#39;Fp1&#39;, &#39;Fpz&#39;, &#39;Fp2&#39;, &#39;AF7&#39;, &#39;AF3&#39;, &#39;F7&#39;]
    Rejecting  epoch based on EEG : [&#39;TP7&#39;]
    Rejecting  epoch based on EEG : [&#39;AF8&#39;]
    Rejecting  epoch based on EEG : [&#39;FC5&#39;, &#39;Fp1&#39;, &#39;Fp2&#39;, &#39;AF7&#39;]
    Rejecting  epoch based on EEG : [&#39;FC5&#39;, &#39;Fp1&#39;, &#39;Fpz&#39;, &#39;Fp2&#39;, &#39;AF7&#39;, &#39;AF3&#39;, &#39;AFz&#39;, &#39;AF4&#39;, &#39;AF8&#39;, &#39;F7&#39;, &#39;F5&#39;, &#39;F3&#39;, &#39;F1&#39;, &#39;FT7&#39;]
    Rejecting  epoch based on EEG : [&#39;FC5&#39;]
    Rejecting  epoch based on EEG : [&#39;Fp1&#39;, &#39;Fp2&#39;, &#39;AF7&#39;, &#39;AF8&#39;, &#39;F7&#39;]
    Rejecting  epoch based on EEG : [&#39;FC5&#39;, &#39;Fp1&#39;, &#39;Fpz&#39;, &#39;Fp2&#39;, &#39;AF7&#39;, &#39;AF3&#39;, &#39;AF4&#39;, &#39;AF8&#39;, &#39;F7&#39;, &#39;F5&#39;, &#39;F6&#39;, &#39;FT7&#39;]
    Rejecting  epoch based on EEG : [&#39;AF7&#39;]
    Rejecting  epoch based on EEG : [&#39;Fp1&#39;, &#39;Fpz&#39;, &#39;AF7&#39;, &#39;AF8&#39;]
    Rejecting  epoch based on EEG : [&#39;FC5&#39;, &#39;TP7&#39;]
    Rejecting  epoch based on EEG : [&#39;TP7&#39;]
    Rejecting  epoch based on EEG : [&#39;TP7&#39;]
    Rejecting  epoch based on EEG : [&#39;FC5&#39;, &#39;Fp1&#39;, &#39;Fpz&#39;, &#39;Fp2&#39;, &#39;AF7&#39;, &#39;F7&#39;]
    Rejecting  epoch based on EEG : [&#39;TP7&#39;]
    Rejecting  epoch based on EEG : [&#39;AF7&#39;]
    Rejecting  epoch based on EEG : [&#39;Fp1&#39;, &#39;AF7&#39;, &#39;AF8&#39;]
    Rejecting  epoch based on EEG : [&#39;TP7&#39;]
    Rejecting  epoch based on EEG : [&#39;TP7&#39;]
    Rejecting  epoch based on EEG : [&#39;TP7&#39;]
    Rejecting  epoch based on EEG : [&#39;AF7&#39;]
    Rejecting  epoch based on EEG : [&#39;TP7&#39;]
    Rejecting  epoch based on EEG : [&#39;FC5&#39;, &#39;AF7&#39;, &#39;F7&#39;, &#39;F5&#39;, &#39;TP7&#39;]
    Rejecting  epoch based on EEG : [&#39;TP7&#39;]
    Rejecting  epoch based on EEG : [&#39;TP7&#39;]
    Rejecting  epoch based on EEG : [&#39;AF7&#39;, &#39;TP7&#39;]
    Rejecting  epoch based on EEG : [&#39;TP7&#39;]
    Rejecting  epoch based on EEG : [&#39;TP7&#39;]
    Rejecting  epoch based on EEG : [&#39;TP7&#39;]
    Rejecting  epoch based on EEG : [&#39;Fp1&#39;, &#39;Fpz&#39;, &#39;Fp2&#39;, &#39;AF7&#39;, &#39;AF4&#39;, &#39;AF8&#39;]
    Rejecting  epoch based on EEG : [&#39;Fp1&#39;, &#39;Fpz&#39;]
64 bad epochs dropped
</pre></div>
</div>
<p>First, let’s compute the power spectral density and plot it.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><a href="https://mne.tools/stable/generated/mne.time_frequency.EpochsSpectrum.html#mne.time_frequency.EpochsSpectrum" title="mne.time_frequency.EpochsSpectrum" class="sphx-glr-backref-module-mne-time_frequency sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">psd</span></a> <span class="o">=</span> <a href="https://mne.tools/stable/generated/mne.Epochs.html#mne.Epochs.compute_psd" title="mne.Epochs.compute_psd" class="sphx-glr-backref-module-mne sphx-glr-backref-type-py-method"><span class="n">epochs</span><span class="o">.</span><span class="n">compute_psd</span></a><span class="p">(</span><span class="n">fmax</span><span class="o">=</span><span class="mi">75</span><span class="p">)</span>
<a href="https://mne.tools/stable/generated/mne.time_frequency.EpochsSpectrum.html#mne.time_frequency.EpochsSpectrum.plot" title="mne.time_frequency.EpochsSpectrum.plot" class="sphx-glr-backref-module-mne-time_frequency sphx-glr-backref-type-py-method"><span class="n">psd</span><span class="o">.</span><span class="n">plot</span></a><span class="p">()</span>
</pre></div>
</div>
<img src="../_images/sphx_glr_plot_power_spectral_density_001.png" srcset="../_images/sphx_glr_plot_power_spectral_density_001.png" alt="EEG" class = "sphx-glr-single-img"/><div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>    Using multitaper spectrum estimation with 7 DPSS windows
Averaging across epochs...

&lt;MNELineFigure size 1000x350 with 2 Axes&gt;
</pre></div>
</div>
<p>There is a very large artifact in our signal from the power supply
to the building where the data was collected, let’s remove that with
a notch filter so that it won’t dominate our signal.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">raw</span><span class="o">.</span><span class="n">notch_filter</span><span class="p">([</span><span class="mi">60</span><span class="p">])</span>
<a href="https://mne.tools/stable/generated/mne.Epochs.html#mne.Epochs" title="mne.Epochs" class="sphx-glr-backref-module-mne sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">epochs</span></a> <span class="o">=</span> <a href="https://mne.tools/stable/generated/mne.Epochs.html#mne.Epochs" title="mne.Epochs" class="sphx-glr-backref-module-mne sphx-glr-backref-type-py-class"><span class="n">mne</span><span class="o">.</span><span class="n">Epochs</span></a><span class="p">(</span>
    <span class="n">raw</span><span class="p">,</span> <span class="n">events</span><span class="p">,</span> <span class="n">tmin</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">tmax</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">reject</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">eeg</span><span class="o">=</span><span class="mf">4e-4</span><span class="p">),</span> <span class="n">baseline</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">preload</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
<a href="https://mne.tools/stable/generated/mne.time_frequency.EpochsSpectrum.html#mne.time_frequency.EpochsSpectrum" title="mne.time_frequency.EpochsSpectrum" class="sphx-glr-backref-module-mne-time_frequency sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">psd</span></a> <span class="o">=</span> <a href="https://mne.tools/stable/generated/mne.Epochs.html#mne.Epochs.compute_psd" title="mne.Epochs.compute_psd" class="sphx-glr-backref-module-mne sphx-glr-backref-type-py-method"><span class="n">epochs</span><span class="o">.</span><span class="n">compute_psd</span></a><span class="p">(</span><span class="n">fmax</span><span class="o">=</span><span class="mi">75</span><span class="p">)</span>
<a href="https://mne.tools/stable/generated/mne.time_frequency.EpochsSpectrum.html#mne.time_frequency.EpochsSpectrum.plot" title="mne.time_frequency.EpochsSpectrum.plot" class="sphx-glr-backref-module-mne-time_frequency sphx-glr-backref-type-py-method"><span class="n">psd</span><span class="o">.</span><span class="n">plot</span></a><span class="p">()</span>
</pre></div>
</div>
<img src="../_images/sphx_glr_plot_power_spectral_density_002.png" srcset="../_images/sphx_glr_plot_power_spectral_density_002.png" alt="EEG" class = "sphx-glr-single-img"/><div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Filtering raw data in 6 contiguous segments
Setting up band-stop filter from 59 - 61 Hz

FIR filter parameters
---------------------
Designing a one-pass, zero-phase, non-causal bandstop filter:
- Windowed time-domain design (firwin) method
- Hamming window with 0.0194 passband ripple and 53 dB stopband attenuation
- Lower passband edge: 59.35
- Lower transition bandwidth: 0.50 Hz (-6 dB cutoff frequency: 59.10 Hz)
- Upper passband edge: 60.65 Hz
- Upper transition bandwidth: 0.50 Hz (-6 dB cutoff frequency: 60.90 Hz)
- Filter length: 1057 samples (6.606 s)

[Parallel(n_jobs=1)]: Using backend SequentialBackend with 1 concurrent workers.
[Parallel(n_jobs=1)]: Done   1 out of   1 | elapsed:    0.0s remaining:    0.0s
[Parallel(n_jobs=1)]: Done   2 out of   2 | elapsed:    0.0s remaining:    0.0s
[Parallel(n_jobs=1)]: Done   3 out of   3 | elapsed:    0.0s remaining:    0.0s
[Parallel(n_jobs=1)]: Done   4 out of   4 | elapsed:    0.0s remaining:    0.0s
[Parallel(n_jobs=1)]: Done  64 out of  64 | elapsed:    0.0s finished
Setting up band-stop filter from 59 - 61 Hz

FIR filter parameters
---------------------
Designing a one-pass, zero-phase, non-causal bandstop filter:
- Windowed time-domain design (firwin) method
- Hamming window with 0.0194 passband ripple and 53 dB stopband attenuation
- Lower passband edge: 59.35
- Lower transition bandwidth: 0.50 Hz (-6 dB cutoff frequency: 59.10 Hz)
- Upper passband edge: 60.65 Hz
- Upper transition bandwidth: 0.50 Hz (-6 dB cutoff frequency: 60.90 Hz)
- Filter length: 1057 samples (6.606 s)

[Parallel(n_jobs=1)]: Using backend SequentialBackend with 1 concurrent workers.
[Parallel(n_jobs=1)]: Done   1 out of   1 | elapsed:    0.0s remaining:    0.0s
[Parallel(n_jobs=1)]: Done   2 out of   2 | elapsed:    0.0s remaining:    0.0s
[Parallel(n_jobs=1)]: Done   3 out of   3 | elapsed:    0.0s remaining:    0.0s
[Parallel(n_jobs=1)]: Done   4 out of   4 | elapsed:    0.0s remaining:    0.0s
[Parallel(n_jobs=1)]: Done  64 out of  64 | elapsed:    0.0s finished
Setting up band-stop filter from 59 - 61 Hz

FIR filter parameters
---------------------
Designing a one-pass, zero-phase, non-causal bandstop filter:
- Windowed time-domain design (firwin) method
- Hamming window with 0.0194 passband ripple and 53 dB stopband attenuation
- Lower passband edge: 59.35
- Lower transition bandwidth: 0.50 Hz (-6 dB cutoff frequency: 59.10 Hz)
- Upper passband edge: 60.65 Hz
- Upper transition bandwidth: 0.50 Hz (-6 dB cutoff frequency: 60.90 Hz)
- Filter length: 1057 samples (6.606 s)

[Parallel(n_jobs=1)]: Using backend SequentialBackend with 1 concurrent workers.
[Parallel(n_jobs=1)]: Done   1 out of   1 | elapsed:    0.0s remaining:    0.0s
[Parallel(n_jobs=1)]: Done   2 out of   2 | elapsed:    0.0s remaining:    0.0s
[Parallel(n_jobs=1)]: Done   3 out of   3 | elapsed:    0.0s remaining:    0.0s
[Parallel(n_jobs=1)]: Done   4 out of   4 | elapsed:    0.0s remaining:    0.0s
[Parallel(n_jobs=1)]: Done  64 out of  64 | elapsed:    0.0s finished
Setting up band-stop filter from 59 - 61 Hz

FIR filter parameters
---------------------
Designing a one-pass, zero-phase, non-causal bandstop filter:
- Windowed time-domain design (firwin) method
- Hamming window with 0.0194 passband ripple and 53 dB stopband attenuation
- Lower passband edge: 59.35
- Lower transition bandwidth: 0.50 Hz (-6 dB cutoff frequency: 59.10 Hz)
- Upper passband edge: 60.65 Hz
- Upper transition bandwidth: 0.50 Hz (-6 dB cutoff frequency: 60.90 Hz)
- Filter length: 1057 samples (6.606 s)

[Parallel(n_jobs=1)]: Using backend SequentialBackend with 1 concurrent workers.
[Parallel(n_jobs=1)]: Done   1 out of   1 | elapsed:    0.0s remaining:    0.0s
[Parallel(n_jobs=1)]: Done   2 out of   2 | elapsed:    0.0s remaining:    0.0s
[Parallel(n_jobs=1)]: Done   3 out of   3 | elapsed:    0.0s remaining:    0.0s
[Parallel(n_jobs=1)]: Done   4 out of   4 | elapsed:    0.0s remaining:    0.0s
[Parallel(n_jobs=1)]: Done  64 out of  64 | elapsed:    0.0s finished
Setting up band-stop filter from 59 - 61 Hz

FIR filter parameters
---------------------
Designing a one-pass, zero-phase, non-causal bandstop filter:
- Windowed time-domain design (firwin) method
- Hamming window with 0.0194 passband ripple and 53 dB stopband attenuation
- Lower passband edge: 59.35
- Lower transition bandwidth: 0.50 Hz (-6 dB cutoff frequency: 59.10 Hz)
- Upper passband edge: 60.65 Hz
- Upper transition bandwidth: 0.50 Hz (-6 dB cutoff frequency: 60.90 Hz)
- Filter length: 1057 samples (6.606 s)

[Parallel(n_jobs=1)]: Using backend SequentialBackend with 1 concurrent workers.
[Parallel(n_jobs=1)]: Done   1 out of   1 | elapsed:    0.0s remaining:    0.0s
[Parallel(n_jobs=1)]: Done   2 out of   2 | elapsed:    0.0s remaining:    0.0s
[Parallel(n_jobs=1)]: Done   3 out of   3 | elapsed:    0.0s remaining:    0.0s
[Parallel(n_jobs=1)]: Done   4 out of   4 | elapsed:    0.0s remaining:    0.0s
[Parallel(n_jobs=1)]: Done  64 out of  64 | elapsed:    0.0s finished
Setting up band-stop filter from 59 - 61 Hz

FIR filter parameters
---------------------
Designing a one-pass, zero-phase, non-causal bandstop filter:
- Windowed time-domain design (firwin) method
- Hamming window with 0.0194 passband ripple and 53 dB stopband attenuation
- Lower passband edge: 59.35
- Lower transition bandwidth: 0.50 Hz (-6 dB cutoff frequency: 59.10 Hz)
- Upper passband edge: 60.65 Hz
- Upper transition bandwidth: 0.50 Hz (-6 dB cutoff frequency: 60.90 Hz)
- Filter length: 1057 samples (6.606 s)

[Parallel(n_jobs=1)]: Using backend SequentialBackend with 1 concurrent workers.
[Parallel(n_jobs=1)]: Done   1 out of   1 | elapsed:    0.0s remaining:    0.0s
[Parallel(n_jobs=1)]: Done   2 out of   2 | elapsed:    0.0s remaining:    0.0s
[Parallel(n_jobs=1)]: Done   3 out of   3 | elapsed:    0.0s remaining:    0.0s
[Parallel(n_jobs=1)]: Done   4 out of   4 | elapsed:    0.0s remaining:    0.0s
[Parallel(n_jobs=1)]: Done  64 out of  64 | elapsed:    0.0s finished
Not setting metadata
180 matching events found
No baseline correction applied
0 projection items activated
Using data from preloaded Raw for 180 events and 321 original time points ...
    Rejecting  epoch based on EEG : [&#39;Fp1&#39;, &#39;Fp2&#39;, &#39;AF8&#39;]
    Rejecting  epoch based on EEG : [&#39;Fp1&#39;, &#39;Fp2&#39;, &#39;AF7&#39;, &#39;AF8&#39;, &#39;F7&#39;]
    Rejecting  epoch based on EEG : [&#39;Fp1&#39;, &#39;Fp2&#39;]
    Rejecting  epoch based on EEG : [&#39;Fp1&#39;, &#39;AF7&#39;, &#39;F7&#39;]
    Rejecting  epoch based on EEG : [&#39;CP1&#39;]
    Rejecting  epoch based on EEG : [&#39;AF8&#39;]
    Rejecting  epoch based on EEG : [&#39;Fp1&#39;, &#39;AF7&#39;, &#39;AF8&#39;, &#39;F7&#39;]
    Rejecting  epoch based on EEG : [&#39;AF7&#39;, &#39;F7&#39;]
    Rejecting  epoch based on EEG : [&#39;F7&#39;]
    Rejecting  epoch based on EEG : [&#39;AF4&#39;]
    Rejecting  epoch based on EEG : [&#39;Fp2&#39;, &#39;AF7&#39;]
    Rejecting  epoch based on EEG : [&#39;Fp1&#39;, &#39;Fpz&#39;, &#39;Fp2&#39;, &#39;AF7&#39;, &#39;AF3&#39;, &#39;AFz&#39;, &#39;F7&#39;, &#39;F5&#39;]
    Rejecting  epoch based on EEG : [&#39;Fp1&#39;, &#39;Fp2&#39;]
    Rejecting  epoch based on EEG : [&#39;Fp1&#39;, &#39;Fpz&#39;, &#39;Fp2&#39;, &#39;AF8&#39;]
    Rejecting  epoch based on EEG : [&#39;FC4&#39;, &#39;FC6&#39;, &#39;Fp1&#39;, &#39;Fpz&#39;, &#39;Fp2&#39;, &#39;AF7&#39;, &#39;AF3&#39;, &#39;AF4&#39;, &#39;AF8&#39;, &#39;F7&#39;, &#39;F5&#39;, &#39;F3&#39;, &#39;F4&#39;, &#39;F6&#39;, &#39;F8&#39;, &#39;FT7&#39;, &#39;TP7&#39;, &#39;P1&#39;, &#39;P8&#39;, &#39;Iz&#39;]
    Rejecting  epoch based on EEG : [&#39;Fp1&#39;, &#39;Fpz&#39;, &#39;Fp2&#39;, &#39;AF7&#39;, &#39;F7&#39;]
    Rejecting  epoch based on EEG : [&#39;Fp1&#39;, &#39;Fpz&#39;, &#39;Fp2&#39;, &#39;AF7&#39;, &#39;AF3&#39;, &#39;F7&#39;, &#39;F5&#39;]
    Rejecting  epoch based on EEG : [&#39;AF7&#39;]
    Rejecting  epoch based on EEG : [&#39;Fp1&#39;, &#39;Fpz&#39;, &#39;AF7&#39;, &#39;AF8&#39;, &#39;F7&#39;, &#39;F5&#39;, &#39;FT7&#39;]
    Rejecting  epoch based on EEG : [&#39;TP7&#39;]
    Rejecting  epoch based on EEG : [&#39;F7&#39;]
    Rejecting  epoch based on EEG : [&#39;TP7&#39;]
    Rejecting  epoch based on EEG : [&#39;TP7&#39;]
    Rejecting  epoch based on EEG : [&#39;F7&#39;, &#39;F5&#39;, &#39;TP7&#39;]
    Rejecting  epoch based on EEG : [&#39;TP7&#39;]
    Rejecting  epoch based on EEG : [&#39;TP7&#39;]
    Rejecting  epoch based on EEG : [&#39;TP7&#39;]
    Rejecting  epoch based on EEG : [&#39;Fp1&#39;, &#39;Fpz&#39;, &#39;Fp2&#39;, &#39;AF7&#39;]
28 bad epochs dropped
    Using multitaper spectrum estimation with 7 DPSS windows
Averaging across epochs...

&lt;MNELineFigure size 1000x350 with 2 Axes&gt;
</pre></div>
</div>
<p>By not passing a method, we used the default <code class="docutils literal notranslate"><span class="pre">method='multitaper'</span></code>. The
Fourier Transform can perfectly resolve a signal into sinusoidal components
of different frequencies given an infinite length signal. Since we only
collect data for a finite amount of time, this causes artifacts in the
power spectrum. The multitaper method uses windows (tapers) of different shapes
each with their own particular artifact that, when averaged, balance out
each other’s artifact. <code class="docutils literal notranslate"><span class="pre">method='welch'</span></code> on the other hand, uses a specified
window but uses a sliding window across time in order to average out artifact.
The default for <code class="docutils literal notranslate"><span class="pre">method='welch'</span></code> is <code class="docutils literal notranslate"><span class="pre">window='hamming'</span></code> which tries to correct
for the artifact/distortion as well as possible with a single window.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><a href="https://mne.tools/stable/generated/mne.time_frequency.EpochsSpectrum.html#mne.time_frequency.EpochsSpectrum" title="mne.time_frequency.EpochsSpectrum" class="sphx-glr-backref-module-mne-time_frequency sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">psd</span></a> <span class="o">=</span> <a href="https://mne.tools/stable/generated/mne.Epochs.html#mne.Epochs.compute_psd" title="mne.Epochs.compute_psd" class="sphx-glr-backref-module-mne sphx-glr-backref-type-py-method"><span class="n">epochs</span><span class="o">.</span><span class="n">compute_psd</span></a><span class="p">(</span><span class="n">fmax</span><span class="o">=</span><span class="mi">75</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;welch&quot;</span><span class="p">)</span>
<a href="https://mne.tools/stable/generated/mne.time_frequency.EpochsSpectrum.html#mne.time_frequency.EpochsSpectrum.plot" title="mne.time_frequency.EpochsSpectrum.plot" class="sphx-glr-backref-module-mne-time_frequency sphx-glr-backref-type-py-method"><span class="n">psd</span><span class="o">.</span><span class="n">plot</span></a><span class="p">()</span>
</pre></div>
</div>
<img src="../_images/sphx_glr_plot_power_spectral_density_003.png" srcset="../_images/sphx_glr_plot_power_spectral_density_003.png" alt="EEG" class = "sphx-glr-single-img"/><div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Effective window size : 2.006 (s)
Averaging across epochs...

&lt;MNELineFigure size 1000x350 with 2 Axes&gt;
</pre></div>
</div>
<p>In general, these methods give similar results in most cases with default
parameters as shown below but the strength of having two methods is the ability
to use different parameters. For the Welch method, the tradeoff between using
a larger <code class="docutils literal notranslate"><span class="pre">n_fft</span></code> and resolving higher frequencies compared to a smaller <code class="docutils literal notranslate"><span class="pre">n_fft</span></code>
and averaging more windows for a cleaner signal can be explored for better signal
resolution. Similarly, adjusting the bandwidth for the multitaper method can
optimize the time resolution-frequency resolution tradeoff.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

<span class="k">for</span> <span class="n">ax</span><span class="p">,</span> <span class="n">bandwidth</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">2</span><span class="p">)):</span>
    <a href="https://mne.tools/stable/generated/mne.time_frequency.EpochsSpectrum.html#mne.time_frequency.EpochsSpectrum" title="mne.time_frequency.EpochsSpectrum" class="sphx-glr-backref-module-mne-time_frequency sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">psd</span></a> <span class="o">=</span> <a href="https://mne.tools/stable/generated/mne.Epochs.html#mne.Epochs.compute_psd" title="mne.Epochs.compute_psd" class="sphx-glr-backref-module-mne sphx-glr-backref-type-py-method"><span class="n">epochs</span><span class="o">.</span><span class="n">compute_psd</span></a><span class="p">(</span><span class="n">fmax</span><span class="o">=</span><span class="mi">75</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;multitaper&quot;</span><span class="p">,</span> <span class="n">bandwidth</span><span class="o">=</span><span class="n">bandwidth</span><span class="p">)</span>
    <a href="https://mne.tools/stable/generated/mne.time_frequency.EpochsSpectrum.html#mne.time_frequency.EpochsSpectrum.plot" title="mne.time_frequency.EpochsSpectrum.plot" class="sphx-glr-backref-module-mne-time_frequency sphx-glr-backref-type-py-method"><span class="n">psd</span><span class="o">.</span><span class="n">plot</span></a><span class="p">(</span><span class="n">axes</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;bandwidth=</span><span class="si">{</span><span class="n">bandwidth</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">ax</span><span class="p">,</span> <span class="n">n_fft</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="o">**</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">10</span><span class="p">)]):</span>
    <a href="https://mne.tools/stable/generated/mne.time_frequency.EpochsSpectrum.html#mne.time_frequency.EpochsSpectrum" title="mne.time_frequency.EpochsSpectrum" class="sphx-glr-backref-module-mne-time_frequency sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">psd</span></a> <span class="o">=</span> <a href="https://mne.tools/stable/generated/mne.Epochs.html#mne.Epochs.compute_psd" title="mne.Epochs.compute_psd" class="sphx-glr-backref-module-mne sphx-glr-backref-type-py-method"><span class="n">epochs</span><span class="o">.</span><span class="n">compute_psd</span></a><span class="p">(</span><span class="n">fmax</span><span class="o">=</span><span class="mi">75</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;welch&quot;</span><span class="p">,</span> <span class="n">n_fft</span><span class="o">=</span><span class="n">n_fft</span><span class="p">)</span>
    <a href="https://mne.tools/stable/generated/mne.time_frequency.EpochsSpectrum.html#mne.time_frequency.EpochsSpectrum.plot" title="mne.time_frequency.EpochsSpectrum.plot" class="sphx-glr-backref-module-mne-time_frequency sphx-glr-backref-type-py-method"><span class="n">psd</span><span class="o">.</span><span class="n">plot</span></a><span class="p">(</span><span class="n">axes</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;n_fft=</span><span class="si">{</span><span class="n">n_fft</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axes</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">flatten</span><span class="p">():</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mf">0.95</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
    <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="s2">&quot;Multitaper&quot;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">transAxes</span>
<span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="s2">&quot;Welch&quot;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">transAxes</span><span class="p">)</span>
</pre></div>
</div>
<img src="../_images/sphx_glr_plot_power_spectral_density_004.png" srcset="../_images/sphx_glr_plot_power_spectral_density_004.png" alt="bandwidth=1, bandwidth=3, bandwidth=5, bandwidth=7, bandwidth=9, n_fft=16, n_fft=32, n_fft=64, n_fft=128, n_fft=256" class = "sphx-glr-single-img"/><div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>    Using multitaper spectrum estimation with 1 DPSS windows
Averaging across epochs...
    Using multitaper spectrum estimation with 5 DPSS windows
Averaging across epochs...
    Using multitaper spectrum estimation with 9 DPSS windows
Averaging across epochs...
    Using multitaper spectrum estimation with 13 DPSS windows
Averaging across epochs...
    Using multitaper spectrum estimation with 17 DPSS windows
Averaging across epochs...
Effective window size : 0.100 (s)
Averaging across epochs...
Effective window size : 0.200 (s)
Averaging across epochs...
Effective window size : 0.400 (s)
Averaging across epochs...
Effective window size : 0.800 (s)
Averaging across epochs...
Effective window size : 1.600 (s)
Averaging across epochs...

Text(-0.5, 0.5, &#39;Welch&#39;)
</pre></div>
</div>
<p>Let’s look at how the power spectral density differs between movement and rest
trials. We can compute an activation map of the squared cross correlations
(r<sup>2</sup>) to tell us how much of the variation in all trials can be
accounted for by the different means between movement and rest trials. This
allows us to narrow down our search to a single channel that will has
differences in power spectral density between the two conditions. In this
case, the channel is C3, the channel most directly over primary motor cortex
which is sensible for a movement task. We’ll examine this channel going
forward to understand power specrtal density with the particular example of
movement compared to rest.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># compute psd</span>
<a href="https://mne.tools/stable/generated/mne.time_frequency.EpochsSpectrum.html#mne.time_frequency.EpochsSpectrum" title="mne.time_frequency.EpochsSpectrum" class="sphx-glr-backref-module-mne-time_frequency sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">psd</span></a> <span class="o">=</span> <a href="https://mne.tools/stable/generated/mne.Epochs.html#mne.Epochs.compute_psd" title="mne.Epochs.compute_psd" class="sphx-glr-backref-module-mne sphx-glr-backref-type-py-method"><span class="n">epochs</span><span class="o">.</span><span class="n">compute_psd</span></a><span class="p">(</span><span class="n">fmax</span><span class="o">=</span><span class="mi">75</span><span class="p">)</span>

<span class="c1"># choose events</span>
<span class="n">event_mask</span> <span class="o">=</span> <span class="p">[</span><span class="n">entry</span> <span class="o">==</span> <span class="p">()</span> <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <a href="https://mne.tools/stable/generated/mne.Epochs.html#mne.Epochs" title="mne.Epochs" class="sphx-glr-backref-module-mne sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">epochs</span></a><span class="o">.</span><span class="n">drop_log</span><span class="p">]</span>
<span class="n">move_events</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span>
    <span class="n">events</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="n">event_id</span><span class="p">[</span><span class="s2">&quot;T1&quot;</span><span class="p">],</span> <span class="n">events</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="n">event_id</span><span class="p">[</span><span class="s2">&quot;T2&quot;</span><span class="p">]</span>
<span class="p">)[</span><span class="n">event_mask</span><span class="p">]</span>
<span class="n">rest_events</span> <span class="o">=</span> <span class="p">(</span><span class="n">events</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="n">event_id</span><span class="p">[</span><span class="s2">&quot;T0&quot;</span><span class="p">])[</span><span class="n">event_mask</span><span class="p">]</span>

<span class="c1"># separate psd data by condition</span>
<span class="n">psd_data</span> <span class="o">=</span> <a href="https://mne.tools/stable/generated/mne.time_frequency.EpochsSpectrum.html#mne.time_frequency.EpochsSpectrum.get_data" title="mne.time_frequency.EpochsSpectrum.get_data" class="sphx-glr-backref-module-mne-time_frequency sphx-glr-backref-type-py-method"><span class="n">psd</span><span class="o">.</span><span class="n">get_data</span></a><span class="p">()</span>
<span class="n">rest_psd_data</span> <span class="o">=</span> <span class="n">psd_data</span><span class="p">[</span><span class="n">rest_events</span><span class="p">]</span>
<span class="n">move_psd_data</span> <span class="o">=</span> <span class="n">psd_data</span><span class="p">[</span><span class="n">move_events</span><span class="p">]</span>

<span class="c1"># compute the ratio used in the activation calculation</span>
<span class="n">n_rest</span> <span class="o">=</span> <span class="n">rest_events</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">n_move</span> <span class="o">=</span> <span class="n">move_events</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">ratio</span> <span class="o">=</span> <span class="n">n_rest</span> <span class="o">*</span> <span class="n">n_move</span> <span class="o">/</span> <span class="p">(</span><span class="n">n_rest</span> <span class="o">+</span> <span class="n">n_move</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>

<span class="c1"># compute the activation</span>
<span class="n">activation</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><a href="https://mne.tools/stable/generated/mne.time_frequency.EpochsSpectrum.html#mne.time_frequency.EpochsSpectrum" title="mne.time_frequency.EpochsSpectrum" class="sphx-glr-backref-module-mne-time_frequency sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">psd</span></a><span class="o">.</span><span class="n">ch_names</span><span class="p">),</span> <a href="https://mne.tools/stable/generated/mne.time_frequency.EpochsSpectrum.html#mne.time_frequency.EpochsSpectrum" title="mne.time_frequency.EpochsSpectrum" class="sphx-glr-backref-module-mne-time_frequency sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">psd</span></a><span class="o">.</span><span class="n">freqs</span><span class="o">.</span><span class="n">size</span><span class="p">))</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">freq</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><a href="https://mne.tools/stable/generated/mne.time_frequency.EpochsSpectrum.html#mne.time_frequency.EpochsSpectrum" title="mne.time_frequency.EpochsSpectrum" class="sphx-glr-backref-module-mne-time_frequency sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">psd</span></a><span class="o">.</span><span class="n">freqs</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">freq</span> <span class="o">&gt;</span> <span class="mi">57</span> <span class="ow">and</span> <span class="n">freq</span> <span class="o">&lt;</span> <span class="mi">63</span><span class="p">:</span>  <span class="c1"># mask line noise</span>
        <span class="k">continue</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><a href="https://mne.tools/stable/generated/mne.time_frequency.EpochsSpectrum.html#mne.time_frequency.EpochsSpectrum" title="mne.time_frequency.EpochsSpectrum" class="sphx-glr-backref-module-mne-time_frequency sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">psd</span></a><span class="o">.</span><span class="n">ch_names</span><span class="p">)):</span>
        <span class="n">mean_diff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">rest_psd_data</span><span class="p">[:,</span> <span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">])</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">move_psd_data</span><span class="p">[:,</span> <span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">])</span>
        <span class="n">activation</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">mean_diff</span><span class="o">**</span><span class="mi">3</span> <span class="o">/</span> <span class="nb">abs</span><span class="p">(</span><span class="n">mean_diff</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">psd_data</span><span class="p">[:,</span> <span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">])</span> <span class="o">*</span> <span class="n">ratio</span>
        <span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Activation&quot;</span><span class="p">)</span>
<span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">activation</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <a href="https://mne.tools/stable/generated/mne.time_frequency.EpochsSpectrum.html#mne.time_frequency.EpochsSpectrum" title="mne.time_frequency.EpochsSpectrum" class="sphx-glr-backref-module-mne-time_frequency sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">psd</span></a><span class="o">.</span><span class="n">freqs</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><a href="https://mne.tools/stable/generated/mne.time_frequency.EpochsSpectrum.html#mne.time_frequency.EpochsSpectrum" title="mne.time_frequency.EpochsSpectrum" class="sphx-glr-backref-module-mne-time_frequency sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">psd</span></a><span class="o">.</span><span class="n">freqs</span><span class="p">[::</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Frequency (Hz)&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><a href="https://mne.tools/stable/generated/mne.time_frequency.EpochsSpectrum.html#mne.time_frequency.EpochsSpectrum" title="mne.time_frequency.EpochsSpectrum" class="sphx-glr-backref-module-mne-time_frequency sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">psd</span></a><span class="o">.</span><span class="n">ch_names</span><span class="p">),</span> <span class="mi">3</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><a href="https://mne.tools/stable/generated/mne.time_frequency.EpochsSpectrum.html#mne.time_frequency.EpochsSpectrum" title="mne.time_frequency.EpochsSpectrum" class="sphx-glr-backref-module-mne-time_frequency sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">psd</span></a><span class="o">.</span><span class="n">ch_names</span><span class="p">[::</span><span class="mi">3</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Channel&quot;</span><span class="p">)</span>
<span class="n">cbar</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Signed $r^2$&quot;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">bottom</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># choose channel with greatest mean activation</span>
<span class="n">ch</span> <span class="o">=</span> <a href="https://mne.tools/stable/generated/mne.time_frequency.EpochsSpectrum.html#mne.time_frequency.EpochsSpectrum" title="mne.time_frequency.EpochsSpectrum" class="sphx-glr-backref-module-mne-time_frequency sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">psd</span></a><span class="o">.</span><span class="n">ch_names</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">activation</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">argmax</span><span class="p">()]</span>
</pre></div>
</div>
<img src="../_images/sphx_glr_plot_power_spectral_density_005.png" srcset="../_images/sphx_glr_plot_power_spectral_density_005.png" alt="Activation" class = "sphx-glr-single-img"/><div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Using multitaper spectrum estimation with 7 DPSS windows
</pre></div>
</div>
<p>There are two main components to a power spectrum: 1) The
power that is present across all frequencies and decreases
exponentially at higher frequencies (called the 1/f component
or power law scaling or broadband power) and 2) peaks, generally with a
normal distribution above this background power. The broadband power
reflects neural activity that is aperiodic and asynchronous; when broadband
power is greater, more neurons are firing total but that they are not
synchronized with each other in an oscillatory rhythm <a class="footnote-reference brackets" href="#footcite-manningetal2009" id="id2" role="doc-noteref"><span class="fn-bracket">[</span>2<span class="fn-bracket">]</span></a>.
Peaks in the power spectrum, on the other hand, are interpreted
as periodic, synchronous neural activity.</p>
<p>We can separate out these using principal component analysis (PCA) as in
<a class="footnote-reference brackets" href="#footcite-milleretal2009a" id="id3" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a>. Let’s see how this works:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># select the only channel so the data is (epochs x freqs)</span>
<span class="n">psd_data</span> <span class="o">=</span> <a href="https://mne.tools/stable/generated/mne.time_frequency.EpochsSpectrum.html#mne.time_frequency.EpochsSpectrum.get_data" title="mne.time_frequency.EpochsSpectrum.get_data" class="sphx-glr-backref-module-mne-time_frequency sphx-glr-backref-type-py-method"><span class="n">psd</span><span class="o">.</span><span class="n">get_data</span></a><span class="p">(</span><span class="n">picks</span><span class="o">=</span><span class="p">[</span><span class="n">ch</span><span class="p">])[:,</span> <span class="mi">0</span><span class="p">]</span>

<span class="c1"># convert to log scale and subtract the mean</span>
<span class="n">psd_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">psd_data</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">psd_data</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>

<span class="c1"># prepare to remove frequencies contaminated by line noise</span>
<span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span><a href="https://mne.tools/stable/generated/mne.time_frequency.EpochsSpectrum.html#mne.time_frequency.EpochsSpectrum" title="mne.time_frequency.EpochsSpectrum" class="sphx-glr-backref-module-mne-time_frequency sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">psd</span></a><span class="o">.</span><span class="n">freqs</span> <span class="o">&lt;</span> <span class="mi">57</span><span class="p">,</span> <a href="https://mne.tools/stable/generated/mne.time_frequency.EpochsSpectrum.html#mne.time_frequency.EpochsSpectrum" title="mne.time_frequency.EpochsSpectrum" class="sphx-glr-backref-module-mne-time_frequency sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">psd</span></a><span class="o">.</span><span class="n">freqs</span> <span class="o">&gt;</span> <span class="mi">63</span><span class="p">)</span>

<span class="c1"># set a random seed for reproducibility</span>
<span class="n">pca</span> <span class="o">=</span> <span class="n">PCA</span><span class="p">(</span><span class="n">svd_solver</span><span class="o">=</span><span class="s2">&quot;randomized&quot;</span><span class="p">,</span> <span class="n">whiten</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">99</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">psd_data</span><span class="p">[:,</span> <span class="n">mask</span><span class="p">])</span>
</pre></div>
</div>
<p>As shown below, the maroon component (1st principal component (PC)) has weights evenly
spread across frequencies whereas the tan component (2nd PC) is peaked at around 16 Hz
which is considered in the beta (13 - 30 Hz) band of frequencies. Because the
oscillations are shaped like normal distributions, a common approach is to fit them
with a normal distribution as in <a class="footnote-reference brackets" href="#footcite-donoghueetal2020" id="id4" role="doc-noteref"><span class="fn-bracket">[</span>3<span class="fn-bracket">]</span></a>.</p>
<p>Admittedly, the separation between oscillatory and broadband components
is not as clean in scalp electroencephalography (EEG) as it is in
electrocorticography (ECoG) as was done in <a class="footnote-reference brackets" href="#footcite-milleretal2009a" id="id5" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a>. ECoG is
implanted on the surface of the brain so it detects more brain signal.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">comp0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><a href="https://mne.tools/stable/generated/mne.time_frequency.EpochsSpectrum.html#mne.time_frequency.EpochsSpectrum" title="mne.time_frequency.EpochsSpectrum" class="sphx-glr-backref-module-mne-time_frequency sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">psd</span></a><span class="o">.</span><span class="n">freqs</span><span class="o">.</span><span class="n">size</span><span class="p">,))</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<span class="n">comp0</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">components_</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><a href="https://mne.tools/stable/generated/mne.time_frequency.EpochsSpectrum.html#mne.time_frequency.EpochsSpectrum" title="mne.time_frequency.EpochsSpectrum" class="sphx-glr-backref-module-mne-time_frequency sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">psd</span></a><span class="o">.</span><span class="n">freqs</span><span class="p">,</span> <span class="n">comp0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;maroon&quot;</span><span class="p">)</span>
<span class="n">comp1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><a href="https://mne.tools/stable/generated/mne.time_frequency.EpochsSpectrum.html#mne.time_frequency.EpochsSpectrum" title="mne.time_frequency.EpochsSpectrum" class="sphx-glr-backref-module-mne-time_frequency sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">psd</span></a><span class="o">.</span><span class="n">freqs</span><span class="o">.</span><span class="n">size</span><span class="p">,))</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<span class="n">comp1</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">components_</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><a href="https://mne.tools/stable/generated/mne.time_frequency.EpochsSpectrum.html#mne.time_frequency.EpochsSpectrum" title="mne.time_frequency.EpochsSpectrum" class="sphx-glr-backref-module-mne-time_frequency sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">psd</span></a><span class="o">.</span><span class="n">freqs</span><span class="p">,</span> <span class="n">comp1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;tan&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Frequency (Hz)&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Component Weight&quot;</span><span class="p">)</span>
</pre></div>
</div>
<img src="../_images/sphx_glr_plot_power_spectral_density_006.png" srcset="../_images/sphx_glr_plot_power_spectral_density_006.png" alt="plot power spectral density" class = "sphx-glr-single-img"/><div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Text(22.347222222222214, 0.5, &#39;Component Weight&#39;)
</pre></div>
</div>
<p>One thing to notice is that the principal components tend to have opposite sign at
the same frequency. This is likely because principal component are required to be
orthogonal. This is not the case for factor analysis, which is PCA without
orthogonal axes. Notice that the first and second PCs mirror each other less
across the <code class="docutils literal notranslate"><span class="pre">y=0</span></code> line.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">psd_data</span> <span class="o">=</span> <a href="https://mne.tools/stable/generated/mne.time_frequency.EpochsSpectrum.html#mne.time_frequency.EpochsSpectrum.get_data" title="mne.time_frequency.EpochsSpectrum.get_data" class="sphx-glr-backref-module-mne-time_frequency sphx-glr-backref-type-py-method"><span class="n">psd</span><span class="o">.</span><span class="n">get_data</span></a><span class="p">(</span><span class="n">picks</span><span class="o">=</span><span class="p">[</span><span class="n">ch</span><span class="p">])[:,</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">psd_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">psd_data</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">psd_data</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
<span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span><a href="https://mne.tools/stable/generated/mne.time_frequency.EpochsSpectrum.html#mne.time_frequency.EpochsSpectrum" title="mne.time_frequency.EpochsSpectrum" class="sphx-glr-backref-module-mne-time_frequency sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">psd</span></a><span class="o">.</span><span class="n">freqs</span> <span class="o">&lt;</span> <span class="mi">57</span><span class="p">,</span> <a href="https://mne.tools/stable/generated/mne.time_frequency.EpochsSpectrum.html#mne.time_frequency.EpochsSpectrum" title="mne.time_frequency.EpochsSpectrum" class="sphx-glr-backref-module-mne-time_frequency sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">psd</span></a><span class="o">.</span><span class="n">freqs</span> <span class="o">&gt;</span> <span class="mi">63</span><span class="p">)</span>
<span class="n">fa</span> <span class="o">=</span> <span class="n">FactorAnalysis</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="s2">&quot;varimax&quot;</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">99</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">psd_data</span><span class="p">[:,</span> <span class="n">mask</span><span class="p">])</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">comp0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><a href="https://mne.tools/stable/generated/mne.time_frequency.EpochsSpectrum.html#mne.time_frequency.EpochsSpectrum" title="mne.time_frequency.EpochsSpectrum" class="sphx-glr-backref-module-mne-time_frequency sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">psd</span></a><span class="o">.</span><span class="n">freqs</span><span class="o">.</span><span class="n">size</span><span class="p">,))</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<span class="n">comp0</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">fa</span><span class="o">.</span><span class="n">components_</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><a href="https://mne.tools/stable/generated/mne.time_frequency.EpochsSpectrum.html#mne.time_frequency.EpochsSpectrum" title="mne.time_frequency.EpochsSpectrum" class="sphx-glr-backref-module-mne-time_frequency sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">psd</span></a><span class="o">.</span><span class="n">freqs</span><span class="p">,</span> <span class="n">comp0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;maroon&quot;</span><span class="p">)</span>
<span class="n">comp1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><a href="https://mne.tools/stable/generated/mne.time_frequency.EpochsSpectrum.html#mne.time_frequency.EpochsSpectrum" title="mne.time_frequency.EpochsSpectrum" class="sphx-glr-backref-module-mne-time_frequency sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">psd</span></a><span class="o">.</span><span class="n">freqs</span><span class="o">.</span><span class="n">size</span><span class="p">,))</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<span class="n">comp1</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">fa</span><span class="o">.</span><span class="n">components_</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><a href="https://mne.tools/stable/generated/mne.time_frequency.EpochsSpectrum.html#mne.time_frequency.EpochsSpectrum" title="mne.time_frequency.EpochsSpectrum" class="sphx-glr-backref-module-mne-time_frequency sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">psd</span></a><span class="o">.</span><span class="n">freqs</span><span class="p">,</span> <span class="n">comp1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;tan&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Frequency (Hz)&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Component Weight&quot;</span><span class="p">)</span>
</pre></div>
</div>
<img src="../_images/sphx_glr_plot_power_spectral_density_007.png" srcset="../_images/sphx_glr_plot_power_spectral_density_007.png" alt="plot power spectral density" class = "sphx-glr-single-img"/><div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Text(31.097222222222214, 0.5, &#39;Component Weight&#39;)
</pre></div>
</div>
<p>Let’s apply the PCA to our data and see if this helps us separate
movement epochs from rest epochs.
We see that we are indeed able to recapitulate the figures from
<a class="footnote-reference brackets" href="#footcite-milleretal2009a" id="id6" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a> with a bit weaker effects using scalp EEG than
ECOG. Note particularly that, as you get into higher frequencies,
the power spectra for the two conditions are parallel.
Where there are more oscillations, in the lower frequencies
(below 30 Hz), this becomes obscured, but, in <a class="footnote-reference brackets" href="#footcite-milleretal2009b" id="id7" role="doc-noteref"><span class="fn-bracket">[</span>4<span class="fn-bracket">]</span></a> higher
frequencies are expolored using ECoG and basically this phenoma holds out at
those higher frequencies indicating that the connectivity of the brain probably
doesn’t change fundamentally but rather this broadband shape shifts up and
down when more or fewer neurons are firing total near the recording site.</p>
<p>Also note that in <a class="footnote-reference brackets" href="#footcite-milleretal2009a" id="id8" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a>, the ECoG grid
covered the regions of primary motor cortex responsible for multiple
movements, whereas the C3 electrode is roughly over primary motor cortex
and so records the activity of a relatively large area of primary motor
cortex, spanning areas that control different limbs. Because of this, we
are unable to see that the broadband shifts occur focally in the
primary motor cortex region that controls the particular movement whereas
the beta desynchronization is more widespread across most of primary
motor cortex. This is evidence that ties into the spotlight hypothesis
of motor control where widespread inhibition of the motor system (which seems
to be mediated by this beta oscillation decrease) facilitates choosing the
correct response (potentially mediated by the broadband power increase)
like quieting a crowd in a stadium order to pick one person out in
particular <a class="footnote-reference brackets" href="#footcite-greenhouseetal2015" id="id9" role="doc-noteref"><span class="fn-bracket">[</span>5<span class="fn-bracket">]</span></a>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">ax2</span><span class="p">,</span> <span class="n">ax3</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Full Recording&quot;</span><span class="p">)</span>
<span class="n">move_psd_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><a href="https://mne.tools/stable/generated/mne.time_frequency.EpochsSpectrum.html#mne.time_frequency.EpochsSpectrum" title="mne.time_frequency.EpochsSpectrum" class="sphx-glr-backref-module-mne-time_frequency sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">psd</span></a><span class="o">.</span><span class="n">freqs</span><span class="o">.</span><span class="n">size</span><span class="p">,))</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<span class="n">move_psd_data</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">psd_data</span><span class="p">[</span><span class="n">move_events</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)[</span><span class="n">mask</span><span class="p">]</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><a href="https://mne.tools/stable/generated/mne.time_frequency.EpochsSpectrum.html#mne.time_frequency.EpochsSpectrum" title="mne.time_frequency.EpochsSpectrum" class="sphx-glr-backref-module-mne-time_frequency sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">psd</span></a><span class="o">.</span><span class="n">freqs</span><span class="p">,</span> <span class="n">move_psd_data</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">rest_psd_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><a href="https://mne.tools/stable/generated/mne.time_frequency.EpochsSpectrum.html#mne.time_frequency.EpochsSpectrum" title="mne.time_frequency.EpochsSpectrum" class="sphx-glr-backref-module-mne-time_frequency sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">psd</span></a><span class="o">.</span><span class="n">freqs</span><span class="o">.</span><span class="n">size</span><span class="p">,))</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<span class="n">rest_psd_data</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">psd_data</span><span class="p">[</span><span class="n">rest_events</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)[</span><span class="n">mask</span><span class="p">]</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><a href="https://mne.tools/stable/generated/mne.time_frequency.EpochsSpectrum.html#mne.time_frequency.EpochsSpectrum" title="mne.time_frequency.EpochsSpectrum" class="sphx-glr-backref-module-mne-time_frequency sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">psd</span></a><span class="o">.</span><span class="n">freqs</span><span class="p">,</span> <span class="n">rest_psd_data</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Frequency (Hz)&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Power ($\mu$$V^2$)&quot;</span><span class="p">)</span>

<span class="n">psd_mean</span> <span class="o">=</span> <span class="n">psd_data</span><span class="p">[:,</span> <span class="n">mask</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;1st PC (Broadband Power)&quot;</span><span class="p">)</span>
<span class="n">move_psd_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><a href="https://mne.tools/stable/generated/mne.time_frequency.EpochsSpectrum.html#mne.time_frequency.EpochsSpectrum" title="mne.time_frequency.EpochsSpectrum" class="sphx-glr-backref-module-mne-time_frequency sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">psd</span></a><span class="o">.</span><span class="n">freqs</span><span class="o">.</span><span class="n">size</span><span class="p">,))</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<span class="n">move_psd_data</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span>
    <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">pca</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">psd_data</span><span class="p">[</span><span class="n">move_events</span><span class="p">][:,</span> <span class="n">mask</span><span class="p">])[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">],</span> <span class="n">pca</span><span class="o">.</span><span class="n">components_</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">])</span>
    <span class="o">+</span> <span class="n">psd_mean</span><span class="p">,</span>
    <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><a href="https://mne.tools/stable/generated/mne.time_frequency.EpochsSpectrum.html#mne.time_frequency.EpochsSpectrum" title="mne.time_frequency.EpochsSpectrum" class="sphx-glr-backref-module-mne-time_frequency sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">psd</span></a><span class="o">.</span><span class="n">freqs</span><span class="p">,</span> <span class="n">move_psd_data</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">rest_psd_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><a href="https://mne.tools/stable/generated/mne.time_frequency.EpochsSpectrum.html#mne.time_frequency.EpochsSpectrum" title="mne.time_frequency.EpochsSpectrum" class="sphx-glr-backref-module-mne-time_frequency sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">psd</span></a><span class="o">.</span><span class="n">freqs</span><span class="o">.</span><span class="n">size</span><span class="p">,))</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<span class="n">rest_psd_data</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span>
    <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">pca</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">psd_data</span><span class="p">[</span><span class="n">rest_events</span><span class="p">][:,</span> <span class="n">mask</span><span class="p">])[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">],</span> <span class="n">pca</span><span class="o">.</span><span class="n">components_</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">])</span>
    <span class="o">+</span> <span class="n">psd_mean</span><span class="p">,</span>
    <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><a href="https://mne.tools/stable/generated/mne.time_frequency.EpochsSpectrum.html#mne.time_frequency.EpochsSpectrum" title="mne.time_frequency.EpochsSpectrum" class="sphx-glr-backref-module-mne-time_frequency sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">psd</span></a><span class="o">.</span><span class="n">freqs</span><span class="p">,</span> <span class="n">rest_psd_data</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Frequency (Hz)&quot;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Power ($\mu$$V^2$)&quot;</span><span class="p">)</span>

<span class="n">ax3</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;2nd PC (Beta Oscillations)&quot;</span><span class="p">)</span>
<span class="n">move_psd_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><a href="https://mne.tools/stable/generated/mne.time_frequency.EpochsSpectrum.html#mne.time_frequency.EpochsSpectrum" title="mne.time_frequency.EpochsSpectrum" class="sphx-glr-backref-module-mne-time_frequency sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">psd</span></a><span class="o">.</span><span class="n">freqs</span><span class="o">.</span><span class="n">size</span><span class="p">,))</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<span class="n">move_psd_data</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span>
    <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">pca</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">psd_data</span><span class="p">[</span><span class="n">move_events</span><span class="p">][:,</span> <span class="n">mask</span><span class="p">])[:,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">],</span> <span class="n">pca</span><span class="o">.</span><span class="n">components_</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">])</span>
    <span class="o">+</span> <span class="n">psd_mean</span><span class="p">,</span>
    <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><a href="https://mne.tools/stable/generated/mne.time_frequency.EpochsSpectrum.html#mne.time_frequency.EpochsSpectrum" title="mne.time_frequency.EpochsSpectrum" class="sphx-glr-backref-module-mne-time_frequency sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">psd</span></a><span class="o">.</span><span class="n">freqs</span><span class="p">,</span> <span class="n">move_psd_data</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">rest_psd_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><a href="https://mne.tools/stable/generated/mne.time_frequency.EpochsSpectrum.html#mne.time_frequency.EpochsSpectrum" title="mne.time_frequency.EpochsSpectrum" class="sphx-glr-backref-module-mne-time_frequency sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">psd</span></a><span class="o">.</span><span class="n">freqs</span><span class="o">.</span><span class="n">size</span><span class="p">,))</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<span class="n">rest_psd_data</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span>
    <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">pca</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">psd_data</span><span class="p">[</span><span class="n">rest_events</span><span class="p">][:,</span> <span class="n">mask</span><span class="p">])[:,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">],</span> <span class="n">pca</span><span class="o">.</span><span class="n">components_</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">])</span>
    <span class="o">+</span> <span class="n">psd_mean</span><span class="p">,</span>
    <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><a href="https://mne.tools/stable/generated/mne.time_frequency.EpochsSpectrum.html#mne.time_frequency.EpochsSpectrum" title="mne.time_frequency.EpochsSpectrum" class="sphx-glr-backref-module-mne-time_frequency sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">psd</span></a><span class="o">.</span><span class="n">freqs</span><span class="p">,</span> <span class="n">rest_psd_data</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Frequency (Hz)&quot;</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Power ($\mu$$V^2$)&quot;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
<img src="../_images/sphx_glr_plot_power_spectral_density_008.png" srcset="../_images/sphx_glr_plot_power_spectral_density_008.png" alt="Full Recording, 1st PC (Broadband Power), 2nd PC (Beta Oscillations)" class = "sphx-glr-single-img"/><p>Finally, let’s calculate the peaks of the components to quantify
our oscillations. We’ll examine two ways: 1) Fitting a normal
distribution (as in <a class="footnote-reference brackets" href="#footcite-donoghueetal2020" id="id10" role="doc-noteref"><span class="fn-bracket">[</span>3<span class="fn-bracket">]</span></a>), 2) using
<code class="xref py py-func docutils literal notranslate"><span class="pre">scipy.signal.find_peaks()</span></code>.
As shown below, with reasonable parameters, these methods
can be used to quantify peaks in the power spectrum. One parameter that must
be determined is the prominence that specifies how much greater than baseline
the peak needs to be for consideration in subsequent analyses. This might be
done based on previous literature or by checking different parameter values
on data not used in the analysis.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">gauss1d</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">((</span><span class="n">x</span> <span class="o">-</span> <span class="n">b</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">c</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">d</span>


<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">comp</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">pca</span><span class="o">.</span><span class="n">components_</span><span class="p">[:</span><span class="mi">3</span><span class="p">]):</span>
    <span class="n">comp</span> <span class="o">-=</span> <span class="n">comp</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="n">thresh</span> <span class="o">=</span> <span class="n">comp</span><span class="o">.</span><span class="n">std</span><span class="p">()</span> <span class="o">*</span> <span class="mi">2</span>
    <span class="c1"># 1D gaussian fit</span>
    <span class="n">gauss_fits</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="n">comp_copy</span> <span class="o">=</span> <span class="n">comp</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">keep_going</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">while</span> <span class="n">keep_going</span><span class="p">:</span>
        <span class="c1"># start at highest peak height and frequency</span>
        <span class="n">a0</span> <span class="o">=</span> <span class="n">comp_copy</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="k">if</span> <span class="n">comp_copy</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="o">-</span><span class="n">comp_copy</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="k">else</span> <span class="n">comp_copy</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
        <span class="n">b0</span> <span class="o">=</span> <a href="https://mne.tools/stable/generated/mne.time_frequency.EpochsSpectrum.html#mne.time_frequency.EpochsSpectrum" title="mne.time_frequency.EpochsSpectrum" class="sphx-glr-backref-module-mne-time_frequency sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">psd</span></a><span class="o">.</span><span class="n">freqs</span><span class="p">[</span><span class="n">mask</span><span class="p">][</span><span class="nb">abs</span><span class="p">(</span><span class="n">comp_copy</span><span class="p">)</span><span class="o">.</span><span class="n">argmax</span><span class="p">()]</span>
        <span class="n">c0</span> <span class="o">=</span> <span class="mi">3</span>  <span class="c1"># 3 Hz standard deviation initial guess</span>
        <span class="n">d0</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># no up-down shift initial guess</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">minimize</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">params</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">gauss1d</span><span class="p">(</span><a href="https://mne.tools/stable/generated/mne.time_frequency.EpochsSpectrum.html#mne.time_frequency.EpochsSpectrum" title="mne.time_frequency.EpochsSpectrum" class="sphx-glr-backref-module-mne-time_frequency sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">psd</span></a><span class="o">.</span><span class="n">freqs</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span> <span class="o">*</span><span class="n">params</span><span class="p">)</span> <span class="o">-</span> <span class="n">comp_copy</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">),</span>
            <span class="n">x0</span><span class="o">=</span><span class="p">[</span><span class="n">a0</span><span class="p">,</span> <span class="n">b0</span><span class="p">,</span> <span class="n">c0</span><span class="p">,</span> <span class="n">d0</span><span class="p">],</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">thresh</span><span class="p">:</span>
            <span class="n">gauss_fits</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
            <span class="n">comp_copy</span> <span class="o">-=</span> <span class="n">gauss1d</span><span class="p">(</span>
                <a href="https://mne.tools/stable/generated/mne.time_frequency.EpochsSpectrum.html#mne.time_frequency.EpochsSpectrum" title="mne.time_frequency.EpochsSpectrum" class="sphx-glr-backref-module-mne-time_frequency sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">psd</span></a><span class="o">.</span><span class="n">freqs</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span> <span class="o">*</span><span class="n">res</span><span class="o">.</span><span class="n">x</span>
            <span class="p">)</span>  <span class="c1"># remove peak after it&#39;s found</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">keep_going</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="c1"># find_peaks</span>
    <span class="n">peaks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="n">find_peaks</span><span class="p">(</span><span class="n">comp</span><span class="p">,</span> <span class="n">prominence</span><span class="o">=</span><span class="n">thresh</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">find_peaks</span><span class="p">(</span><span class="o">-</span><span class="n">comp</span><span class="p">,</span> <span class="n">prominence</span><span class="o">=</span><span class="n">thresh</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
        <span class="p">]</span>
    <span class="p">)</span>
    <span class="c1"># plot</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;PC </span><span class="si">{</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">comp_plot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><a href="https://mne.tools/stable/generated/mne.time_frequency.EpochsSpectrum.html#mne.time_frequency.EpochsSpectrum" title="mne.time_frequency.EpochsSpectrum" class="sphx-glr-backref-module-mne-time_frequency sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">psd</span></a><span class="o">.</span><span class="n">freqs</span><span class="o">.</span><span class="n">size</span><span class="p">))</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="n">comp_plot</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">comp</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><a href="https://mne.tools/stable/generated/mne.time_frequency.EpochsSpectrum.html#mne.time_frequency.EpochsSpectrum" title="mne.time_frequency.EpochsSpectrum" class="sphx-glr-backref-module-mne-time_frequency sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">psd</span></a><span class="o">.</span><span class="n">freqs</span><span class="p">,</span> <span class="n">comp_plot</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;PC&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">res</span> <span class="ow">in</span> <span class="n">gauss_fits</span><span class="p">:</span>
        <span class="n">fit_plot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><a href="https://mne.tools/stable/generated/mne.time_frequency.EpochsSpectrum.html#mne.time_frequency.EpochsSpectrum" title="mne.time_frequency.EpochsSpectrum" class="sphx-glr-backref-module-mne-time_frequency sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">psd</span></a><span class="o">.</span><span class="n">freqs</span><span class="o">.</span><span class="n">size</span><span class="p">))</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="n">fit_plot</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">gauss1d</span><span class="p">(</span><a href="https://mne.tools/stable/generated/mne.time_frequency.EpochsSpectrum.html#mne.time_frequency.EpochsSpectrum" title="mne.time_frequency.EpochsSpectrum" class="sphx-glr-backref-module-mne-time_frequency sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">psd</span></a><span class="o">.</span><span class="n">freqs</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span> <span class="o">*</span><span class="n">res</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><a href="https://mne.tools/stable/generated/mne.time_frequency.EpochsSpectrum.html#mne.time_frequency.EpochsSpectrum" title="mne.time_frequency.EpochsSpectrum" class="sphx-glr-backref-module-mne-time_frequency sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">psd</span></a><span class="o">.</span><span class="n">freqs</span><span class="p">,</span> <span class="n">fit_plot</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;orange&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;gauss&quot;</span><span class="p">)</span>
        <span class="n">peak</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">peak</span> <span class="o">&gt;=</span> <a href="https://mne.tools/stable/generated/mne.time_frequency.EpochsSpectrum.html#mne.time_frequency.EpochsSpectrum" title="mne.time_frequency.EpochsSpectrum" class="sphx-glr-backref-module-mne-time_frequency sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">psd</span></a><span class="o">.</span><span class="n">freqs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">peak</span> <span class="o">&lt;=</span> <a href="https://mne.tools/stable/generated/mne.time_frequency.EpochsSpectrum.html#mne.time_frequency.EpochsSpectrum" title="mne.time_frequency.EpochsSpectrum" class="sphx-glr-backref-module-mne-time_frequency sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">psd</span></a><span class="o">.</span><span class="n">freqs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">peak</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;orange&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">peak</span> <span class="ow">in</span> <span class="n">peaks</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><a href="https://mne.tools/stable/generated/mne.time_frequency.EpochsSpectrum.html#mne.time_frequency.EpochsSpectrum" title="mne.time_frequency.EpochsSpectrum" class="sphx-glr-backref-module-mne-time_frequency sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">psd</span></a><span class="o">.</span><span class="n">freqs</span><span class="p">[</span><span class="n">mask</span><span class="p">][</span><span class="n">peak</span><span class="p">],</span> <span class="n">comp</span><span class="p">[</span><span class="n">peak</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">],</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;find_peaks&quot;</span><span class="p">)</span>  <span class="c1"># for legend</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
<ul class="sphx-glr-horizontal">
<li><img src="../_images/sphx_glr_plot_power_spectral_density_009.png" srcset="../_images/sphx_glr_plot_power_spectral_density_009.png" alt="PC 1" class = "sphx-glr-multi-img"/></li>
<li><img src="../_images/sphx_glr_plot_power_spectral_density_010.png" srcset="../_images/sphx_glr_plot_power_spectral_density_010.png" alt="PC 2" class = "sphx-glr-multi-img"/></li>
<li><img src="../_images/sphx_glr_plot_power_spectral_density_011.png" srcset="../_images/sphx_glr_plot_power_spectral_density_011.png" alt="PC 3" class = "sphx-glr-multi-img"/></li>
</ul>
<p>Lastly, let’s simulate some data and show that, if broadband power shifts and
oscillations are created directly, we are able to decouple them using the
principal component method used above. Indeed, as shown below, a simulated power
spectrum can be separated into a broadband power shift and oscillation
in the first and second principal components respectively.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sfreq</span> <span class="o">=</span> <a href="https://mne.tools/stable/generated/mne.Info.html#mne.Info" title="mne._fiff.meas_info.Info" class="sphx-glr-backref-module-mne-_fiff-meas_info sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">epochs</span><span class="o">.</span><span class="n">info</span></a><span class="p">[</span><span class="s2">&quot;sfreq&quot;</span><span class="p">]</span>
<span class="n">n_epochs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><a href="https://mne.tools/stable/generated/mne.Epochs.html#mne.Epochs" title="mne.Epochs" class="sphx-glr-backref-module-mne sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">epochs</span></a><span class="p">)</span>
<span class="n">times</span> <span class="o">=</span> <a href="https://mne.tools/stable/generated/mne.Epochs.html#mne.Epochs.times" title="mne.Epochs.times" class="sphx-glr-backref-module-mne sphx-glr-backref-type-py-property"><span class="n">epochs</span><span class="o">.</span><span class="n">times</span></a>
<span class="n">epochs_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_epochs</span><span class="p">,</span> <span class="n">times</span><span class="o">.</span><span class="n">size</span><span class="p">))</span>
<span class="n">slope</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">freq</span> <span class="o">=</span> <span class="mi">16</span>
<span class="n">n_fft_points</span> <span class="o">=</span> <span class="n">times</span><span class="o">.</span><span class="n">size</span> <span class="o">//</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">times</span><span class="o">.</span><span class="n">size</span> <span class="o">%</span> <span class="mi">2</span>

<span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span>  <span class="c1"># seed a random number generator</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">epochs_data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
    <span class="c1"># generate pink noise</span>
    <span class="n">shift</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># decouple from beta</span>
    <span class="n">amplitude</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mf">0.02</span><span class="p">)</span>  <span class="c1"># decouple from broadband</span>
    <span class="n">std</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">shift</span> <span class="o">*</span> <span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">rng</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">n_fft_points</span><span class="p">)</span> <span class="o">+</span> <span class="n">rng</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">n_fft_points</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1</span><span class="n">j</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="c1"># add beta oscillation</span>
    <span class="n">x</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">size</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">**</span> <span class="n">slope</span><span class="p">)</span>
    <span class="n">freqs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n_fft_points</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="n">n_fft_points</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">+=</span> <span class="n">gauss1d</span><span class="p">(</span><span class="n">freqs</span><span class="p">,</span> <span class="n">amplitude</span><span class="p">,</span> <span class="n">freq</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">+=</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">gauss1d</span><span class="p">(</span><span class="n">freqs</span><span class="p">,</span> <span class="n">amplitude</span><span class="p">,</span> <span class="n">freq</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">irfft</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">real</span>
    <span class="n">y</span> <span class="o">/=</span> <span class="n">y</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="p">[:</span> <span class="o">-</span><span class="p">(</span><span class="n">times</span><span class="o">.</span><span class="n">size</span> <span class="o">%</span> <span class="mi">2</span><span class="p">)]</span>
    <span class="n">epochs_data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span> <span class="o">*</span> <span class="n">rng</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1e-6</span>  <span class="c1"># different amounts per trial</span>

<span class="c1"># make epochs object, compute psd</span>
<a href="https://mne.tools/stable/generated/mne.Info.html#mne.Info" title="mne._fiff.meas_info.Info" class="sphx-glr-backref-module-mne-_fiff-meas_info sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">info</span></a> <span class="o">=</span> <a href="https://mne.tools/stable/generated/mne.create_info.html#mne.create_info" title="mne.create_info" class="sphx-glr-backref-module-mne sphx-glr-backref-type-py-function"><span class="n">mne</span><span class="o">.</span><span class="n">create_info</span></a><span class="p">([</span><span class="n">ch</span><span class="p">],</span> <span class="n">sfreq</span><span class="o">=</span><span class="n">sfreq</span><span class="p">,</span> <span class="n">ch_types</span><span class="o">=</span><span class="s2">&quot;eeg&quot;</span><span class="p">)</span>
<a href="https://mne.tools/stable/generated/mne.Info.html#mne.Info.set_montage" title="mne.Info.set_montage" class="sphx-glr-backref-module-mne sphx-glr-backref-type-py-method"><span class="n">info</span><span class="o">.</span><span class="n">set_montage</span></a><span class="p">(</span><a href="https://mne.tools/stable/generated/mne.Epochs.html#mne.Epochs.get_montage" title="mne.Epochs.get_montage" class="sphx-glr-backref-module-mne sphx-glr-backref-type-py-method"><span class="n">epochs</span><span class="o">.</span><span class="n">get_montage</span></a><span class="p">())</span>
<a href="https://mne.tools/stable/generated/mne.EpochsArray.html#mne.EpochsArray" title="mne.EpochsArray" class="sphx-glr-backref-module-mne sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">epochs_sim</span></a> <span class="o">=</span> <a href="https://mne.tools/stable/generated/mne.EpochsArray.html#mne.EpochsArray" title="mne.EpochsArray" class="sphx-glr-backref-module-mne sphx-glr-backref-type-py-class"><span class="n">mne</span><span class="o">.</span><span class="n">EpochsArray</span></a><span class="p">(</span><span class="n">epochs_data</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">],</span> <a href="https://mne.tools/stable/generated/mne.Info.html#mne.Info" title="mne._fiff.meas_info.Info" class="sphx-glr-backref-module-mne-_fiff-meas_info sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">info</span></a><span class="p">)</span>
<a href="https://mne.tools/stable/generated/mne.time_frequency.EpochsSpectrum.html#mne.time_frequency.EpochsSpectrum" title="mne.time_frequency.EpochsSpectrum" class="sphx-glr-backref-module-mne-time_frequency sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">psd_sim</span></a> <span class="o">=</span> <a href="https://mne.tools/stable/generated/mne.EpochsArray.html#mne.EpochsArray.compute_psd" title="mne.EpochsArray.compute_psd" class="sphx-glr-backref-module-mne sphx-glr-backref-type-py-method"><span class="n">epochs_sim</span><span class="o">.</span><span class="n">compute_psd</span></a><span class="p">(</span><span class="n">fmax</span><span class="o">=</span><span class="mi">75</span><span class="p">)</span>
<a href="https://mne.tools/stable/generated/mne.time_frequency.EpochsSpectrum.html#mne.time_frequency.EpochsSpectrum.plot" title="mne.time_frequency.EpochsSpectrum.plot" class="sphx-glr-backref-module-mne-time_frequency sphx-glr-backref-type-py-method"><span class="n">psd_sim</span><span class="o">.</span><span class="n">plot</span></a><span class="p">()</span>

<span class="c1"># check that our method works</span>
<span class="n">psd_data</span> <span class="o">=</span> <a href="https://mne.tools/stable/generated/mne.time_frequency.EpochsSpectrum.html#mne.time_frequency.EpochsSpectrum.get_data" title="mne.time_frequency.EpochsSpectrum.get_data" class="sphx-glr-backref-module-mne-time_frequency sphx-glr-backref-type-py-method"><span class="n">psd_sim</span><span class="o">.</span><span class="n">get_data</span></a><span class="p">()[:,</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">psd_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">psd_data</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">psd_data</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>

<span class="c1"># prepare to remove frequencies contaminated by line noise</span>
<span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span><a href="https://mne.tools/stable/generated/mne.time_frequency.EpochsSpectrum.html#mne.time_frequency.EpochsSpectrum" title="mne.time_frequency.EpochsSpectrum" class="sphx-glr-backref-module-mne-time_frequency sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">psd</span></a><span class="o">.</span><span class="n">freqs</span> <span class="o">&lt;</span> <span class="mi">57</span><span class="p">,</span> <a href="https://mne.tools/stable/generated/mne.time_frequency.EpochsSpectrum.html#mne.time_frequency.EpochsSpectrum" title="mne.time_frequency.EpochsSpectrum" class="sphx-glr-backref-module-mne-time_frequency sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">psd</span></a><span class="o">.</span><span class="n">freqs</span> <span class="o">&gt;</span> <span class="mi">63</span><span class="p">)</span>

<span class="c1"># set a random seed for reproducibility</span>
<span class="n">pca</span> <span class="o">=</span> <span class="n">PCA</span><span class="p">(</span><span class="n">whiten</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">99</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">psd_data</span><span class="p">[:,</span> <span class="n">mask</span><span class="p">])</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">comp0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><a href="https://mne.tools/stable/generated/mne.time_frequency.EpochsSpectrum.html#mne.time_frequency.EpochsSpectrum" title="mne.time_frequency.EpochsSpectrum" class="sphx-glr-backref-module-mne-time_frequency sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">psd</span></a><span class="o">.</span><span class="n">freqs</span><span class="o">.</span><span class="n">size</span><span class="p">,))</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<span class="n">comp0</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">components_</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><a href="https://mne.tools/stable/generated/mne.time_frequency.EpochsSpectrum.html#mne.time_frequency.EpochsSpectrum" title="mne.time_frequency.EpochsSpectrum" class="sphx-glr-backref-module-mne-time_frequency sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">psd</span></a><span class="o">.</span><span class="n">freqs</span><span class="p">,</span> <span class="n">comp0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;maroon&quot;</span><span class="p">)</span>
<span class="n">comp1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><a href="https://mne.tools/stable/generated/mne.time_frequency.EpochsSpectrum.html#mne.time_frequency.EpochsSpectrum" title="mne.time_frequency.EpochsSpectrum" class="sphx-glr-backref-module-mne-time_frequency sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">psd</span></a><span class="o">.</span><span class="n">freqs</span><span class="o">.</span><span class="n">size</span><span class="p">,))</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<span class="n">comp1</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">components_</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><a href="https://mne.tools/stable/generated/mne.time_frequency.EpochsSpectrum.html#mne.time_frequency.EpochsSpectrum" title="mne.time_frequency.EpochsSpectrum" class="sphx-glr-backref-module-mne-time_frequency sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">psd</span></a><span class="o">.</span><span class="n">freqs</span><span class="p">,</span> <span class="n">comp1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;tan&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Frequency (Hz)&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Component Weight&quot;</span><span class="p">)</span>
</pre></div>
</div>
<ul class="sphx-glr-horizontal">
<li><img src="../_images/sphx_glr_plot_power_spectral_density_012.png" srcset="../_images/sphx_glr_plot_power_spectral_density_012.png" alt="EEG" class = "sphx-glr-multi-img"/></li>
<li><img src="../_images/sphx_glr_plot_power_spectral_density_013.png" srcset="../_images/sphx_glr_plot_power_spectral_density_013.png" alt="plot power spectral density" class = "sphx-glr-multi-img"/></li>
</ul>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Not setting metadata
152 matching events found
No baseline correction applied
0 projection items activated
    Using multitaper spectrum estimation with 7 DPSS windows
Averaging across epochs...
Need more than one channel to make topography for eeg. Disabling interactivity.

Text(31.097222222222214, 0.5, &#39;Component Weight&#39;)
</pre></div>
</div>
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> ( 0 minutes  18.987 seconds)</p>
<div class="sphx-glr-footer sphx-glr-footer-example docutils container" id="sphx-glr-download-auto-examples-plot-power-spectral-density-py">
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="../_downloads/690c14ff197ea143dba2c456771558c0/plot_power_spectral_density.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">plot_power_spectral_density.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="../_downloads/6b71a6d78af1a2e18665ba3a1edf25f4/plot_power_spectral_density.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">plot_power_spectral_density.ipynb</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</section>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2023, Alexander P. Rockhill.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 6.1.3.<br/>
    </p>
  </div>
</footer>
  </body>
</html>